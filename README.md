
# Zed Sieve Extension

A comprehensive Language Server Protocol extension for [Zed](https://zed.dev) that provides intelligent editing support for the Sieve email filtering language (RFC 5228) with enhanced support for Proton Mail's advanced features.

## Repo structure

```
zed-sieve/
‚îú‚îÄ‚îÄ extension.toml             # Zed extension configuration
‚îú‚îÄ‚îÄ src/                       # Extension source code
‚îÇ   ‚îî‚îÄ‚îÄ extension.rs           # Main extension implementation
‚îú‚îÄ‚îÄ grammars/                 # Tree-sitter grammars for Sieve language (Auto-Generated by Zed during install)
‚îú‚îÄ‚îÄ languages/                 # Language configuration
‚îÇ   ‚îî‚îÄ‚îÄ sieve/
‚îÇ       ‚îú‚îÄ‚îÄ highlights.scm     # Syntax highlighting queries
‚îÇ       ‚îî‚îÄ‚îÄ config.toml        # Language-specific settings
‚îú‚îÄ‚îÄ docs/                      # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ installation.md
‚îÇ   ‚îú‚îÄ‚îÄ configuration.md
‚îÇ   ‚îî‚îÄ‚îÄ features.md
‚îú‚îÄ‚îÄ examples/                  # Example configurations
‚îÇ   ‚îî‚îÄ‚îÄ settings.json
‚îú‚îÄ‚îÄ Cargo.toml                 # Rust extension config
‚îú‚îÄ‚îÄ README.md                 # Installation and usage instructions
‚îú‚îÄ‚îÄ LICENSE
‚îî‚îÄ‚îÄ .gitignore
```
## Features

### ‚ú® Language Support
- **Complete RFC 5228 compliance** - Full support for the Sieve base specification
- **Proton Mail extensions** - Advanced features like `expire`, `currentdate`, and more
- **Tree-sitter grammar** - Precise syntax highlighting and code structure
- **Language Server Protocol** - Rich editing experience with diagnostics, completion, and hover info

### üéØ Editor Features
- **Syntax Highlighting** - Beautiful, accurate highlighting for all Sieve constructs
- **Code Completion** - Smart completions for tests, actions, tags, and extensions
  - Type any Sieve command to see available completions
  - Trigger with `:` for tag completions
  - Context-aware suggestions based on cursor position
- **Error Diagnostics** - Real-time syntax error detection and reporting
  - Real-time syntax validation
  - Missing semicolon detection
  - Invalid command highlighting
  - Extension requirement checking
- **Hover Documentation** - Inline help for Sieve commands and extensions
  - Command description
  - Parameter information
  - Usage examples
  - Extension requirements
- **Auto-formatting** - Consistent code style and indentation
- **Comment Support** - Both line (`#`) and block (`/* */`) comments

### üöÄ Sieve Language Coverage
- **Core Tests**: `address`, `allof`, `anyof`, `envelope`, `exists`, `header`, `not`, `size`, `true`, `false`
- **Core Actions**: `discard`, `fileinto`, `keep`, `redirect`, `reject`, `stop`
- **Extensions**: `body`, `copy`, `date`, `regex`, `vacation`, `variables`, `relational`, and more
- **Proton Features**: `expire`, `currentdate`, advanced date operations, custom filters

## Installation

### Prerequisites
- [Zed editor](https://zed.dev) (latest version)
- [Node.js](https://nodejs.org) v16+ (for language server)
- [Rust](https://rustup.rs/) (for extension compilation)

### Install via Zed Extensions
1. Open Zed
2. Press `Cmd+Shift+P` (macOS) or `Ctrl+Shift+P` (Linux/Windows)
3. Type "Extensions" and select "Extensions: Install Extension"
4. Search for "Sieve" and install

### Manual Installation
1. Clone this repository:
   ```bash
   git clone https://github.com/yourusername/zed-sieve
   cd zed-sieve
   ```
2. Open Zed
3. Press `Cmd+Shift+X` (macOS) or `Ctrl+Shift+X` (Linux/Windows)
4. Click the `Install Dev Extension` button and select the repo directory
5. Configure Zed for Sieve extension:
   ```bash
   # Merge Zed configs for Sieve extension (To project only)
   jq -s '.[0] * .[1]' .zed/settings.json ~/.config/zed/settings.json > .zed/settings.json

   # OR Merge Zed configs for Sieve extension (To global)
   jq -s '.[0] * .[1]' .zed/settings.json ~/.config/zed/settings.json > .config/zed/settings.json
   ```
5. Restart Zed (optional)

## Usage

### File Types

The extension automatically activates for files with these extensions:
- `.sieve` - Standard Sieve scripts
- `.sv` - Alternative Sieve extension

## Configuration

### Extension Options
- `protonExtensions`: Enable Proton Mail specific features (default: true)
- `strictMode`: Enforce RFC 5228 compliance only (default: false)

## Development

### Building from Source
1. Clone this repository:
   ```bash
   git clone https://github.com/yourusername/zed-sieve
   cd zed-sieve
   ```

2. Run tests:
   ```bash
   # Extension server tests
   cargo check
   cargo test
   ```

3. Build Extension:
   ```bash
   cargo build
   ```

### Contributing
1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## RFC 5228 Compliance

This extension implements the complete Sieve specification:
- ‚úÖ Base language (RFC 5228)
- ‚úÖ Body extension (RFC 5173)
- ‚úÖ Copy extension (RFC 3894)
- ‚úÖ Date extension (RFC 5260)
- ‚úÖ Environment extension (RFC 5183)
- ‚úÖ Regex extension (draft-ietf-sieve-regex)
- ‚úÖ Variables extension (RFC 5229)
- ‚úÖ Vacation extension (RFC 5230)
- ‚úÖ Relational extension (RFC 5231)

### Proton Mail Extensions
Additional support for Proton's advanced features:
- `expire` action for message expiration
- `currentdate` test for time-based filtering
- Enhanced date/time operations
- Custom flag management

## License

MIT License - see [LICENSE](LICENSE) for details.

## Support

- **Issues**: [GitHub Issues](https://github.com/yourusername/zed-sieve/issues)
- **Documentation**: [Sieve RFC 5228](https://datatracker.ietf.org/doc/html/rfc5228)
- **Proton Help**: [Proton Sieve Documentation](https://proton.me/support/sieve-advanced-custom-filters)

---

Built with ‚ù§Ô∏è for the Zed editor community
